webpackJsonp([8],{"+IyU":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),i=a.n(r),s=a("woOf"),o=a.n(s),l=a("vMJZ"),n=a("STSY"),d=a("NYxO"),u={directives:{waves:a("cAgV").a},data:function(){return{downloadLoading:!1,list:null,listAll:null,listLoading:!1,listPageParams:{pageNo:1,pageNum:20},queryParams:{ledger:"",offset:0,limit:20},ledgerDetail:{serial_id:"",invoice_org:"",vendor:"",create_time:"",amount:""},tableKey:0,total:null,dialogFormVisible:!1,dialogStatus:"",dialogTitleMap:{update:"编辑",create:"创建"},editForm:{username:"",password:"",statu:"",deptName:"",roleId:""},editFormRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:5,max:10,message:"长度在 5 到 10 个字符",trigger:"blur"}],roleId:[{required:!0,message:"请选择角色",trigger:"blur"}],statu:[{required:!0,message:"请选择状态",trigger:"blur"}]},editRolesOptions:[],editIsDisabled:{0:!1,1:!0},statusOptions:[0,1]}},created:function(){this.getUserList(),this.user_upd=this.permissions.user_upd,this.user_del=this.permissions.user_del,this.user_add=this.permissions.user_add},methods:{getUserList:function(){var e=this,t=this.queryParams.ledger=this.$route.params.ledgerid;this.listLoading=!0,Object(l.e)(this.queryParams).then(function(t){e.list=t.results,e.total=t.count,e.listLoading=!1}),Object(l.c)(t).then(function(t){e.ledgerDetail.serial_id=t.serial_id,e.ledgerDetail.invoice_org=t.invoice_org,e.ledgerDetail.vendor=t.vendor,e.ledgerDetail.create_time=t.create_time,e.ledgerDetail.amount=t.amount})},getRoleList:function(){var e=this;Object(n.a)().then(function(t){e.editRolesOptions=t.data})},handleAdd:function(){this.formReset(),this.dialogStatus="create",this.dialogFormVisible=!0},handleSearch:function(){this.listPageParams.pageNo=0,this.getUserList()},handlePageNumChange:function(e){this.listPageParams.pageNum=this.queryParams.limit=e,this.getUserList()},handlePageNoChange:function(e){this.listPageParams.pageNo=e,this.queryParams.offset=this.listPageParams.pageNum*(e-1),this.getUserList()},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除该用户(用户名:"+e.username+"), 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(l.b)(e.userId).then(function(e){e.data?(t.getUserList(),t.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3})):t.$notify({title:"失败",message:"删除失败",type:"error",duration:2e3})})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},formCreate:function(e){var t=this;this.$refs[e].validate(function(e){return e?(Object(l.a)(t.editForm).then(function(e){e.data?(t.dialogFormVisible=!1,t.getUserList(),t.$notify({title:"成功",message:"添加成功",type:"success",duration:2e3})):t.$notify({title:"失败",message:"添加失败",type:"error",duration:2e3})}),e):e})},formCancel:function(e){this.dialogFormVisible=!1,this.$refs[e].resetFields()},formEdit:function(e){var t=this;this.formReset(),this.dialogStatus="update",this.dialogFormVisible=!0,Object(l.f)(e.userId).then(function(e){t.editForm.username=e.data.username,t.editForm.password="",t.editForm.statu=e.data.statu,t.editForm.userId=e.data.userId,t.editForm.roleId=e.data.roleList.length>0?e.data.roleList[0].roleId:""})},formUpdate:function(e){var t=this;this.$refs[e].validate(function(e){return e?(Object(l.i)(t.editForm).then(function(e){e.data?(t.dialogFormVisible=!1,t.getUserList(),t.$notify({title:"成功",message:"修改成功",type:"success",duration:2e3})):t.$notify({title:"失败",message:"修改失败",type:"error",duration:2e3})}),e):e})},formReset:function(){this.editForm={username:"",password:"",statu:"",roleId:""}},handleDownload:function(){var e=this;Object(l.e)({ledger:this.queryParams.ledger}).then(function(t){var r=t.results;e.downloadLoading=!0,Object(l.c)(e.queryParams.ledger).then(function(t){var i=r.map(function(e){var a=o()({},e),r=new Date(1e3*e.create_time);a.create_time=r.toLocaleString(),a.vendor=t.vendor,a.invoice_org=t.invoice_org,a.ledger_id=t.serial_id;var i=new Date(1e3*t.create_time);return a.ledger_time=i.toLocaleString(),a.ledger_amount=t.amount,a});Promise.all([a.e(15),a.e(16)]).then(a.bind(null,"X5Of")).then(function(t){var a=e.formatJson(["serial_id","create_time","category","start_loc","end_loc","palate","amount","vendor","invoice_org","ledger_id","ledger_time","ledger_amount"],i);t.export_json_to_excel({header:["单据单号","创建时间","单据类别","出发地","目的地","车牌号","应付金额","供应商","签约主体","对账单号","对账时间","对账单总金额"],data:a,filename:e.filename}),e.downloadLoading=!1})})})},formatJson:function(e,t){return t.map(function(t){return e.map(function(e){return t[e]})})}},computed:i()({},Object(d.b)(["permissions"])),filters:{statusFilter:function(e){return{0:"有效",1:"无效",9:"锁定"}[e]}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container calendar-list-container"},[a("div",{staticClass:"top"},[a("el-row",[a("p",{staticClass:"title"},[e._v("基本信息")])]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[e._v("供应商: "+e._s(e.ledgerDetail.vendor))]),e._v(" "),a("el-col",{attrs:{span:8}},[e._v("签约主体: "+e._s(e.ledgerDetail.invoice_org))])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[e._v("对账单号: "+e._s(e.ledgerDetail.serial_id))]),e._v(" "),a("el-col",{attrs:{span:8}},[e._v("对账单总金额: "+e._s(e.ledgerDetail.amount)+"元")])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[e._v("对账时间: "+e._s(e._f("parseTime")(e.ledgerDetail.create_time,"{y}-{m}-{d} {h}:{i}")))])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("p",{staticClass:"title"},[e._v("单据明细")])]),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticStyle:{"margin-bottom":"20px",float:"right"},attrs:{loading:e.downloadLoading,type:"primary",icon:"search"},on:{click:function(t){e.handleDownload()}}},[e._v("导出")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.list,"element-loading-text":"数据加载中...",border:"",fit:"","highlight-current-row":"","default-sort":{prop:"serial_id",order:"descending"}}},[a("el-table-column",{attrs:{align:"center",label:"单据单号",sortable:"",prop:"serial_id"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.serial_id))]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("\n          "+e._s(e._f("parseTime")(t.row.create_time,"{y}-{m}-{d} {h}:{i}"))+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"单据类别","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.category)+" ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"路线名称",sortable:"",prop:"createTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.start_loc)+"--"+e._s(t.row.end_loc))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center","class-name":"status-col",label:"车牌号"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",[e._v(e._s(t.row.palate))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"应付金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.amount)+"元")])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center","class-name":"status-col",label:"上链ID"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",[e._v(e._s(t.row.txid))])]}}])})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.listLoading,expression:"!listLoading"}],staticClass:"pagination-container"},[a("el-pagination",{attrs:{background:"","current-page":e.listPageParams.pageNo,"page-sizes":[20,40,60,80,100],"page-size":e.listPageParams.pageNum,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handlePageNumChange,"current-change":e.handlePageNoChange,"update:currentPage":function(t){e.$set(e.listPageParams,"pageNo",t)}}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.dialogTitleMap[e.dialogStatus],visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.editFormRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{placeholder:"请输用户名"},model:{value:e.editForm.username,callback:function(t){e.$set(e.editForm,"username",t)},expression:"editForm.username"}})],1),e._v(" "),"create"==e.dialogStatus?a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:e.editForm.password,callback:function(t){e.$set(e.editForm,"password",t)},expression:"editForm.password"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"角色",prop:"roleId"}},[a("el-select",{staticClass:"filter-item",attrs:{placeholder:"请选择"},model:{value:e.editForm.roleId,callback:function(t){e.$set(e.editForm,"roleId",t)},expression:"editForm.roleId"}},e._l(e.editRolesOptions,function(t){return a("el-option",{key:t.roleId,attrs:{label:t.roleDesc,value:t.roleId,disabled:e.editIsDisabled[t.statu]}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.roleDesc))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.roleCode))])])}))],1),e._v(" "),"update"==e.dialogStatus&&e.user_del?a("el-form-item",{attrs:{label:"状态",prop:"statu"}},[a("el-select",{staticClass:"filter-item",attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.editForm.statu,callback:function(t){e.$set(e.editForm,"statu",t)},expression:"editForm.statu"}},e._l(e.statusOptions,function(t,r){return a("el-option",{key:r,attrs:{label:e._f("statusFilter")(t),value:t}})}))],1):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.formCancel("editForm")}}},[e._v("取 消")]),e._v(" "),"create"==e.dialogStatus?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.formCreate("editForm")}}},[e._v("确 定")]):a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.formUpdate("editForm")}}},[e._v("修 改")])],1)],1)],1)},staticRenderFns:[]};var m=a("VU/8")(u,c,!1,function(e){a("fNgM")},"data-v-2201e9c6",null);t.default=m.exports},fNgM:function(e,t,a){var r=a("wIij");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("rjj0")("24e8219f",r,!0)},wIij:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.top[data-v-2201e9c6]{\n  margin: 0 0px;\n  border-bottom: 1px solid rgb(179, 179, 179);\n}\n.el-row[data-v-2201e9c6] {\n  margin-top: 15px;\n  margin-bottom: 15px;\n&:last-child {\n    margin-bottom: 0;\n}\n}\n.el-col[data-v-2201e9c6] {\n  border-radius: 4px;\n  font-size: 14px;\n}\n.title[data-v-2201e9c6]{\n  font-weight: 600;\n  font-size: 18px;\n}\n.filter-item[data-v-2201e9c6]{\n  margin-top: 10px;\n  float: right;\n}\n",""])}});